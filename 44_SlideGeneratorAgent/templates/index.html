<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SlideGeneratorAgent ‚Äî Create Slides Fast</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --slide-font-scale:1 }
    body{ background:#0b1220; color:#e6eef8; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial }
    .glass{ background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.06); backdrop-filter: blur(8px) }
    /* Light theme override */
    body.light{ background:#f6f8fb; color:#0b1220 }
    body.light .glass{ background: #ffffffaa; border-color:#e5e7eb }
    body.light .text-slate-300{ color:#475569 }
    /* Slide card scaling + compact mode */
    .slide-card{ font-size: calc(16px * var(--slide-font-scale)); }
    body.compact .slide-card{ padding: 1rem !important }
    body.compact .slide-card ul{ margin-top: .5rem !important }
    body.compact .slide-card li{ margin-top: .15rem !important }
    /* Progress bar */
    #progressOuter{ height:8px }
    #progressInner{ width:0%; transition: width .25s ease }
  </style>
</head>
<body>
  <main class="min-h-screen px-5 py-10">
    <section class="max-w-5xl mx-auto space-y-6">
      <header class="flex items-center justify-between">
        <div>
          <div class="flex items-center gap-2">
            <h1 class="text-3xl md:text-4xl font-extrabold">üñºÔ∏è Slide <span class="text-indigo-300">Generator</span> Agent</h1>
            <span class="px-2 py-0.5 text-xs rounded-full bg-emerald-600/20 border border-emerald-500/40 text-emerald-200">AI Agent</span>
          </div>
          <p class="text-slate-300/80 mt-1">AI‚Äëgenerated slides from a single topic. Choose language, preview, and download.</p>
        </div>
        <div class="text-right text-sm text-slate-400">
          <div id="slideMeta" class="hidden">Slides: <span id="slideCount">0</span> ‚Ä¢ Est. <span id="slideEta">0</span> min</div>
        </div>
      </header>

      <section class="grid grid-cols-1 lg:grid-cols-3 gap-5">
        <div class="lg:col-span-1 glass rounded-2xl p-4 space-y-3">
          <label class="text-xs text-slate-300">Topic</label>
          <input id="topic" type="text" placeholder="e.g., Neural Networks"
                 class="w-full p-3 rounded-xl bg-slate-900/40 border border-slate-700/40 focus:outline-none focus:ring focus:ring-indigo-600/30" />

          <label class="text-xs text-slate-300">Language</label>
          <select id="language" class="w-full p-2 rounded-xl bg-slate-900/40 border border-slate-700/40">
            {% for lang in languages %}
            <option value="{{ lang.code }}">{{ lang.label }}</option>
            {% endfor %}
          </select>

          <div class="grid grid-cols-2 gap-2 pt-1">
            <div class="flex items-center gap-2 text-sm">
              <input id="themeToggle" type="checkbox" class="accent-indigo-500" />
              <label for="themeToggle">Light theme</label>
            </div>
            <div class="flex items-center gap-2 text-sm justify-end">
              <input id="compactToggle" type="checkbox" class="accent-indigo-500" />
              <label for="compactToggle">Compact</label>
            </div>
          </div>

          <div class="pt-1">
            <label class="text-xs text-slate-300">Font size</label>
            <input id="fontRange" type="range" min="0.9" max="1.3" step="0.05" value="1" class="w-full" />
          </div>

          <button id="generate" class="w-full mt-2 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 font-semibold flex items-center justify-center gap-2">
            <svg id="spin" class="hidden animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <span id="genLabel">Generate Slides</span>
          </button>

          <div class="grid grid-cols-2 gap-2 pt-2">
            <a id="dlMd" class="text-center py-2 rounded-lg bg-slate-700/40 border border-slate-600/40 cursor-not-allowed opacity-60">Download .md</a>
            <a id="dlHtml" class="text-center py-2 rounded-lg bg-slate-700/40 border border-slate-600/40 cursor-not-allowed opacity-60">Download .html</a>
          </div>

          <div id="errorBox" class="hidden mt-3 p-3 rounded-lg bg-red-900/30 border border-red-700/40 text-red-200 text-sm"></div>
        </div>

        <div class="lg:col-span-2 space-y-3">
          <div class="glass rounded-2xl p-4">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Preview</div>
              <div class="flex items-center gap-2">
                <button id="prevSlide" class="px-3 py-1 rounded-lg bg-slate-800/60 border border-slate-600/40 text-sm">‚óÄ Prev</button>
                <span id="slideIndicator" class="text-xs text-slate-400">0 / 0</span>
                <button id="nextSlide" class="px-3 py-1 rounded-lg bg-slate-800/60 border border-slate-600/40 text-sm">Next ‚ñ∂</button>
              </div>
            </div>
            <div id="progressOuter" class="w-full mt-3 rounded-full bg-slate-700/40 border border-slate-600/40 hidden">
              <div id="progressInner" class="h-full rounded-full bg-indigo-600"></div>
            </div>
            <div id="slides" class="mt-3"></div>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2" id="thumbnails"></div>
        </div>
      </section>
    </section>
  </main>

  <script>
    const topic = document.getElementById('topic');
    const language = document.getElementById('language');
    const btn = document.getElementById('generate');
    const slidesEl = document.getElementById('slides');
    const slideMeta = document.getElementById('slideMeta');
    const slideCount = document.getElementById('slideCount');
    const slideEta = document.getElementById('slideEta');
    const dlMd = document.getElementById('dlMd');
    const dlHtml = document.getElementById('dlHtml');
    const spin = document.getElementById('spin');
    const genLabel = document.getElementById('genLabel');
    const errorBox = document.getElementById('errorBox');
    const prevSlide = document.getElementById('prevSlide');
    const nextSlide = document.getElementById('nextSlide');
    const slideIndicator = document.getElementById('slideIndicator');
    const thumbnails = document.getElementById('thumbnails');
    const themeToggle = document.getElementById('themeToggle');
    const compactToggle = document.getElementById('compactToggle');
    const fontRange = document.getElementById('fontRange');
    const progressOuter = document.getElementById('progressOuter');
    const progressInner = document.getElementById('progressInner');

    let lastSlug = null;
    let currentSlides = [];
    let currentIndex = 0;

    function slideCard(slide){
      const card = document.createElement('article');
      card.className = 'slide-card rounded-3xl bg-white text-slate-900 shadow-2xl p-8 aspect-video max-h-[60vh] overflow-auto';
      const h = document.createElement('h3');
      h.className = 'text-2xl font-bold';
      h.textContent = slide.title;
      const img = document.createElement('img');
      if(slide.image_url){
        img.src = slide.image_url;
        img.alt = slide.title || 'slide image';
        img.loading = 'lazy';
        img.className = 'w-full rounded-xl border border-slate-200 mt-3';
        // Hide image if it fails to load (invalid URL or blocked)
        img.addEventListener('error', ()=>{
          img.remove();
        });
      }
      const ul = document.createElement('ul');
      ul.className = 'mt-4 space-y-2';
      slide.bullets.forEach(b => {
        const li = document.createElement('li');
        li.className = 'list-disc ml-6 text-lg';
        li.textContent = b;
        ul.appendChild(li);
      });
      card.appendChild(h);
      if(slide.image_url){ card.appendChild(img); }
      card.appendChild(ul);
      return card;
    }

    function renderThumbnails(slides){
      thumbnails.innerHTML = '';
      slides.forEach((s, idx) => {
        const t = document.createElement('button');
        t.className = 'rounded-xl bg-slate-800/60 border border-slate-700/50 p-3 text-left hover:bg-slate-700/60';
        t.innerHTML = `<div class="text-xs text-slate-300 truncate">${s.title}</div>`;
        t.addEventListener('click', ()=> showSlide(idx));
        thumbnails.appendChild(t);
      });
    }

    function showSlide(idx){
      if(!currentSlides.length) return;
      currentIndex = (idx + currentSlides.length) % currentSlides.length;
      slidesEl.innerHTML = '';
      slidesEl.appendChild(slideCard(currentSlides[currentIndex]));
      slideIndicator.textContent = `${currentIndex+1} / ${currentSlides.length}`;
    }

    function renderSlides(slides){
      currentSlides = slides || [];
      renderThumbnails(currentSlides);
      showSlide(0);
    }

    function enableDownloads(slug, enable){
      lastSlug = enable ? slug : null;
      const cls = 'text-center py-2 rounded-lg';
      if(enable){
        dlMd.className = cls + ' bg-emerald-600 hover:bg-emerald-500';
        dlHtml.className = cls + ' bg-amber-600 hover:bg-amber-500';
        dlMd.href = `/download/${slug}/slides.md`;
        dlHtml.href = `/download/${slug}/index.html`;
        dlMd.setAttribute('download','slides.md');
        dlHtml.setAttribute('download','slides.html');
      } else {
        dlMd.className = cls + ' bg-slate-700/40 border border-slate-600/40 cursor-not-allowed opacity-60';
        dlHtml.className = cls + ' bg-slate-700/40 border border-slate-600/40 cursor-not-allowed opacity-60';
        dlMd.removeAttribute('href');
        dlHtml.removeAttribute('href');
      }
    }

    function setLoading(on){
      btn.disabled = on;
      spin.classList.toggle('hidden', !on);
      genLabel.textContent = on ? 'Generating...' : 'Generate Slides';
      progressOuter.classList.toggle('hidden', !on);
      if(on){ simulateProgressStart(); } else { simulateProgressStop(true); }
    }

    function showError(msg){
      errorBox.textContent = msg;
      errorBox.classList.remove('hidden');
    }

    function clearError(){
      errorBox.textContent = '';
      errorBox.classList.add('hidden');
    }

    async function generate(){
      const t = (topic.value || '').trim();
      if(!t){ alert('Enter a topic'); return; }
      clearError();
      setLoading(true);
      enableDownloads('', false);
      try{
        const resp = await fetch('/api/generate', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ topic: t, language: language.value })
        });
        const body = await resp.json().catch(()=>({}));
        if(!resp.ok || body.success === false){
          throw new Error(body.error || 'Generation failed. Ensure OPENAI_API_KEY is set.');
        }
        const data = body;
        renderSlides(data.slides);
        slideCount.textContent = data.slide_count;
        slideEta.textContent = data.est_minutes;
        slideMeta.classList.remove('hidden');
        enableDownloads(data.slug, true);
      }catch(e){
        showError(e.message || 'Error');
      }finally{
        setLoading(false);
      }
    }

    // Simulated progress during generation
    let progressTimer = null;
    function simulateProgressStart(){
      let pct = 0;
      progressInner.style.width = '0%';
      clearInterval(progressTimer);
      progressTimer = setInterval(()=>{
        // ease toward 85% while waiting
        pct = Math.min(85, pct + Math.max(1, 6 - Math.floor(pct/15)));
        progressInner.style.width = pct + '%';
      }, 250);
    }
    function simulateProgressStop(complete){
      if(progressTimer){ clearInterval(progressTimer); progressTimer = null; }
      progressInner.style.width = complete ? '100%' : '0%';
      // after a brief moment, reset bar
      if(complete){ setTimeout(()=>{ progressOuter.classList.add('hidden'); progressInner.style.width = '0%'; }, 400); }
    }

    // UI settings: theme, compact, font size (persisted)
    function applyTheme(light){
      document.body.classList.toggle('light', !!light);
      localStorage.setItem('slides_theme_light', light ? '1' : '0');
    }
    function applyCompact(comp){
      document.body.classList.toggle('compact', !!comp);
      localStorage.setItem('slides_compact', comp ? '1' : '0');
    }
    function applyFontScale(scale){
      document.documentElement.style.setProperty('--slide-font-scale', String(scale||1));
      localStorage.setItem('slides_font_scale', String(scale||1));
    }

    // Initialize from storage
    (function initSettings(){
      const light = localStorage.getItem('slides_theme_light') === '1';
      const comp = localStorage.getItem('slides_compact') === '1';
      const scale = parseFloat(localStorage.getItem('slides_font_scale')||'1') || 1;
      themeToggle.checked = light;
      compactToggle.checked = comp;
      fontRange.value = String(scale);
      applyTheme(light);
      applyCompact(comp);
      applyFontScale(scale);
    })();

    themeToggle.addEventListener('change', (e)=> applyTheme(e.target.checked));
    compactToggle.addEventListener('change', (e)=> applyCompact(e.target.checked));
    fontRange.addEventListener('input', (e)=> applyFontScale(e.target.value));

    btn.addEventListener('click', generate);
    topic.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey)&&e.key==='Enter'){ generate(); } });
    prevSlide.addEventListener('click', ()=> showSlide(currentIndex-1));
    nextSlide.addEventListener('click', ()=> showSlide(currentIndex+1));
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft') showSlide(currentIndex-1);
      if(e.key === 'ArrowRight') showSlide(currentIndex+1);
    });
  </script>
</body>
</html>


